(()=>{"use strict";function t(t){return t.indexOf("?")>-1?t.split("?")[0]:t.indexOf("/")>-1?t.split("/")[0]:t.indexOf("&")>-1?t.split("&")[0]:t}function e(e){var r=e;r=r.replace(/#t=.*$/,"");var i=/youtube:\/\/|https?:\/\/youtu\.be\/|http:\/\/y2u\.be\//g;if(i.test(r))return t(r.split(i)[1]);var n=/\/v\/|\/vi\//g;if(n.test(r))return t(r.split(n)[1]);var o=/v=|vi=/g;if(o.test(r))return t(r.split(o)[1].split("&")[0]);var s=/\/an_webp\//g;if(s.test(r))return t(r.split(s)[1]);var a=/\/embed\//g;if(a.test(r))return t(r.split(a)[1]);if(!/\/user\/([a-zA-Z0-9]*)$/g.test(r)){if(/\/user\/(?!.*videos)/g.test(r))return t(r.split("/").pop());var c=/\/attribution_link\?.*v%3D([^%&]*)(%26|&|$)/;return c.test(r)?t(r.match(c)[1]):void 0}}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],i=!0,n=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(r.push(s.value),!e||r.length!==e);i=!0);}catch(t){n=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw o}}return r}}(t,e)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function n(t){var e,i,n=t;if(n.indexOf("#")>-1){var o=n.split("#");n=r(o,1)[0]}if(n.indexOf("?")>-1&&-1===n.indexOf("clip_id=")){var s=n.split("?");n=r(s,1)[0]}var a=/https?:\/\/vimeo\.com\/([0-9]+)/.exec(n);if(a&&a[1])return a[1];var c=["https?://player.vimeo.com/video/[0-9]+$","https?://vimeo.com/channels","groups","album"].join("|");return new RegExp(c,"gim").test(n)?(i=n.split("/"))&&i.length&&(e=i.pop()):/clip_id=/gim.test(n)&&(i=n.split("clip_id="))&&i.length&&(e=r(i[1].split("&"),1)[0]),e}function o(t){var e=/https:\/\/vine\.co\/v\/([a-zA-Z0-9]*)\/?/.exec(t);return e&&e[1]}function s(t){var e;if(t.indexOf("embed")>-1)return e=/embed\/(\w{8})/,t.match(e)[1];e=/\/v\/(\w{8})/;var r=t.match(e);return r&&r.length>0?t.match(e)[1]:void 0}function a(t){var e=(t.indexOf("embed")>-1?/https:\/\/web\.microsoftstream\.com\/embed\/video\/([a-zA-Z0-9-]*)\/?/:/https:\/\/web\.microsoftstream\.com\/video\/([a-zA-Z0-9-]*)\/?/).exec(t);return e&&e[1]}chrome.runtime.onMessage.addListener((async function(t,r,i){if("update"===t.message){const{url:r}=t,{id:i}=function(t){if("string"!=typeof t)throw new TypeError("get-video-id expects a string");var r=t;/<iframe/gi.test(r)&&(r=function(t){if("string"!=typeof t)throw new TypeError("get-src expected a string");var e=/src="(.*?)"/gm.exec(t);if(e&&e.length>=2)return e[1]}(r)),r=(r=(r=r.trim()).replace("-nocookie","")).replace("/www.","/");var i={id:null,service:null};if(/\/\/google/.test(r)){var c=r.match(/url=([^&]+)&/);c&&(r=decodeURIComponent(c[1]))}return/youtube|youtu\.be|y2u\.be|i.ytimg\./.test(r)?i={id:e(r),service:"youtube"}:/vimeo/.test(r)?i={id:n(r),service:"vimeo"}:/vine/.test(r)?i={id:o(r),service:"vine"}:/videopress/.test(r)?i={id:s(r),service:"videopress"}:/microsoftstream/.test(r)&&(i={id:a(r),service:"microsoftstream"}),i}(r);if(i){const t=await async function(t){const e={video:t};try{const t=await fetch("https://content-caution-video-reporting.vercel.app/api/getreports",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return(await t.json())?.data}catch(t){throw"Issue getting data"}}(r);Array.isArray(t)&&t.length>0?(c=t).filter((t=>"ep_trigger"===t)).length>=c.filter((t=>"no_ep_trigger"===t)).length?(chrome.runtime.sendMessage({status:"ep_trigger"}),chrome.storage.local.set({status:"ep_trigger"})):(chrome.runtime.sendMessage({status:"no_ep_trigger"}),chrome.storage.local.set({status:"no_ep_trigger"})):(chrome.runtime.sendMessage({status:"no_info"}),chrome.storage.local.set({status:"no_info"}))}else chrome.runtime.sendMessage({status:"no_info"}),chrome.storage.local.set({status:"no_info"})}var c}))})();